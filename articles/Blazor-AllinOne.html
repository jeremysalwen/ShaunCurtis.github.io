<!DOCTYPE html>
<html lang="en"><head><meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<base href="/">

	

	

	
	<link href="/resources/vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
	<link href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i" rel="stylesheet">

	
	<link href="/resources/css/sb-admin-2.css" rel="stylesheet" type="text/css">
	<link href="/resources/css/site.css" rel="stylesheet" type="text/css">

	
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
	<link rel="stylesheet" href="/resources/css/article.css" type="text/css">

	
	<link rel="icon" href="/images/favicon.png">

	<title>Blazor All In One - Multi SPA Hosting</title>
        <meta property="author" content="Shaun Curtis" />
        <meta property="description" content="How to build a single Blazor Application that runs in both WASM and Server Modes." />
    <meta property="og:site_name" content="Cold Elm Coders" />
        <meta property="og:site" content="https://shauncurtis.github.io/" />
        <meta property="og:title" content="Blazor All In One - Multi SPA Hosting" />
        <meta property="og:description" content="How to build a single Blazor Application that runs in both WASM and Server Modes." /></head>
<body><header class="navbar bg-dark p-2 text-large text-light"><section class="navbar-section  text-light"><a href="/" class="navbar-brand mr-2 text-large text-light p-2">Cold Elm Coders</a>
			<a href="/Posts" class="btn btn-link text-light">Posts</a>
			<a href="/Rants" class="btn btn-link text-light">Rants</a>
			<a href="/Articles" class="btn btn-link text-light">Articles</a>
			<a href="/Stories" class="btn btn-link text-light">Stories</a>
			<a href="/about.html" class="btn btn-link text-light">About</a></section></header>

	<div class="container-fluid"><div class="row"><div class="col-12 col-sm-3 col-lg-2 bg-light pt-2"><div class="article-info p-2"><div class="mb-2">Published: 26-Feb-2021</div>
                <div class="mb-2">Updated: 04-Apr-2021</div>
                <div class="mb-2">Author: Shaun Curtis</div></div>
    <h4 class="p-2">Table of Contents</h4>
<ul class="TOC" >
<li class="TOC-item TOC-item-0" >
<a class="TOC-link" href="#">Top</a>
<ul class="TOC TOC-0" >
<li class="TOC-item TOC-item-1" >
<ul class="TOC TOC-1" >
<li class="TOC-item TOC-item-2" >
<a class="TOC-link" href="#code-repository">Code Repository</a>
</li>
<li class="TOC-item TOC-item-2" >
<a class="TOC-link" href="#the-solution-and-projects">The Solution and Projects</a>
</li>
<li class="TOC-item TOC-item-2" >
<a class="TOC-link" href="#blazor-project-changes">Blazor Project Changes</a>
</li>
<li class="TOC-item TOC-item-2" >
<a class="TOC-link" href="#blazor.web">Blazor.Web</a>
</li>
<li class="TOC-item TOC-item-2" >
<a class="TOC-link" href="#run-the-application">Run the Application</a>
</li>
<li class="TOC-item TOC-item-2" >
<a class="TOC-link" href="#adding-a-dataservice">Adding a DataService</a>
</li>
<li class="TOC-item TOC-item-2" >
<a class="TOC-link" href="#building-and-run-the-project">Building and Run the project</a>
</li>
<li class="TOC-item TOC-item-2" >
<a class="TOC-link" href="#how-does-it-work">How Does It Work?</a>
</li>
<li class="TOC-item TOC-item-2" >
<a class="TOC-link" href="#wrap-up">Wrap Up</a>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
			
			<div class="col-12 col-sm-9 col-lg-10 p-2"><div class="pt-2 pb-2 border-bottom mb-4 text-primary"><h1>Blazor All In One - Multi SPA Hosting</h1>
            <div><small>How to build a single Blazor Application that runs in both WASM and Server Modes.</small></div></div>
    <p>This article shows how to build a single Blazor application that runs in both WASM and Server Modes.</p>
<p><img src="https://shauncurtis.github.io/articles/assets/Blazor-AllinOne/Screenshot.png" alt="screenshot" /></p>
<h2 id="code-repository">Code Repository</h2>
<p>The Code repository for the article is <a href="https://github.com/ShaunCurtis/AllinOne">here - https://github.com/ShaunCurtis/AllinOne </a></p>
<h2 id="the-solution-and-projects">The Solution and Projects</h2>
<p>Create a new solution called <strong>Blazor</strong> using the Blazor WebAssembly template.  Don't choose to host it on Aspnetcore.  You will get a single project called <strong>Blazor</strong>.</p>
<p>Now add a second project to the solution using the <em>ASP.NET Core Web App</em> template.  Call it <strong>Blazor.Web</strong>.  Set it as the startup project.</p>
<p>The solution should now look like this:</p>
<p><img src="https://shauncurtis.github.io/articles/assets/Blazor-AllinOne/Base-Projects.png" alt="Solution" /></p>
<h2 id="blazor-project-changes">Blazor Project Changes</h2>
<p>The solution runs the WASM context in a sub-directory on the web site.  To get this working there are a few modifications that need to be made to the <em>Blazor</em> project.</p>
<ol>
<li>Move the contents of wwwroot to <em>Blazor.Web</em> and delete everything in <em>wwwroot</em>.</li>
<li>Add a <code>StaticWebAssetBasePath</code> entry to the project file set to <code>wasm</code>.  This is case sensitive in the context in which it is used, so stick to small letters.</li>
<li>Add the necessary packages.</li>
</ol>
<p>The project file should look like this:</p>
<pre><code class="language-xml">&lt;Project Sdk=&quot;Microsoft.NET.Sdk.BlazorWebAssembly&quot;&gt;

  &lt;PropertyGroup&gt;
    &lt;StaticWebAssetBasePath&gt;wasm&lt;/StaticWebAssetBasePath&gt;
    &lt;TargetFramework&gt;net5.0&lt;/TargetFramework&gt;
  &lt;/PropertyGroup&gt;

  &lt;ItemGroup&gt;
    &lt;PackageReference Include=&quot;Microsoft.AspNetCore.Components.WebAssembly&quot; Version=&quot;5.0.4&quot; /&gt;
    &lt;PackageReference Include=&quot;Microsoft.AspNetCore.Components.WebAssembly.DevServer&quot; Version=&quot;5.0.4&quot; PrivateAssets=&quot;all&quot; /&gt;
    &lt;PackageReference Include=&quot;System.Net.Http.Json&quot; Version=&quot;5.0.0&quot; /&gt;
  &lt;/ItemGroup&gt;

  &lt;ItemGroup&gt;
    &lt;Folder Include=&quot;wwwroot\&quot; /&gt;
  &lt;/ItemGroup&gt;

&lt;/Project&gt;
</code></pre>
<h3 id="mainlayout">MainLayout</h3>
<p><code>MainLayout</code> needs to be modified to handle both contexts.  The solution changes the colour scheme for each context.  WASM  <em>Teal</em> and Server <em>Steel</em>.</p>
<pre><code class="language-csharp">@inherits LayoutComponentBase
&lt;div class=&quot;page&quot;&gt;
    @*change class*@
    &lt;div class=&quot;@_sidebarCss&quot;&gt;
        &lt;NavMenu /&gt;
    &lt;/div&gt;
    &lt;div class=&quot;main&quot;&gt;
        &lt;div class=&quot;top-row px-4&quot;&gt;
            &lt;a href=&quot;https://docs.microsoft.com/aspnet/&quot; target=&quot;_blank&quot;&gt;About&lt;/a&gt;
        &lt;/div&gt;
        &lt;div class=&quot;content px-4&quot;&gt;
            @Body
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;

@code {
    [Inject] NavigationManager NavManager { get; set; }
    private bool _isWasm =&gt; NavManager?.Uri.Contains(&quot;wasm&quot;, StringComparison.CurrentCultureIgnoreCase) ?? false;
    private string _sidebarCss =&gt; _isWasm ? &quot;sidebar sidebar-teal&quot; : &quot;sidebar sidebar-steel&quot;;
}
</code></pre>
<p>Add the following Css styles to the component Css file below <code>.sidebar</code>.</p>
<pre><code class="language-css">.sidebar {
    background-image: linear-gradient(180deg, rgb(5, 39, 103) 0%, #3a0647 70%);
}

/* Added Styles*/
.sidebar-teal {
    background-image: linear-gradient(180deg, rgb(0, 64, 128) 0%, rgb(0,96,192) 70%);
}

.sidebar-steel {
    background-image: linear-gradient(180deg, #2a3f4f 0%, #446680 70%);
}
/* End Added Styles*/
</code></pre>
<h3 id="navmenu">NavMenu</h3>
<p>Add code and markup - it adds a link to switch between contexts.</p>
<pre><code class="language-csharp">&lt;div class=&quot;top-row pl-4 navbar navbar-dark&quot;&gt;
    @*Change title*@
    &lt;a class=&quot;navbar-brand&quot; href=&quot;&quot;&gt;Blazor&lt;/a&gt;
    &lt;button class=&quot;navbar-toggler&quot; @onclick=&quot;ToggleNavMenu&quot;&gt;
        &lt;span class=&quot;navbar-toggler-icon&quot;&gt;&lt;/span&gt;
    &lt;/button&gt;
&lt;/div&gt;

&lt;div class=&quot;@NavMenuCssClass&quot; @onclick=&quot;ToggleNavMenu&quot;&gt;
    &lt;ul class=&quot;nav flex-column&quot;&gt;
        @*Add links between contexts*@
        &lt;li class=&quot;nav-item px-3&quot;&gt;
                &lt;NavLink class=&quot;nav-link&quot; href=&quot;@_otherContextUrl&quot; Match=&quot;NavLinkMatch.All&quot;&gt;
                    &lt;span class=&quot;oi oi-home&quot; aria-hidden=&quot;true&quot;&gt;&lt;/span&gt; @_otherContextLinkName
                &lt;/NavLink&gt;
        &lt;/li&gt;
        &lt;li class=&quot;nav-item px-3&quot;&gt;
            &lt;NavLink class=&quot;nav-link&quot; href=&quot;&quot; Match=&quot;NavLinkMatch.All&quot;&gt;
                &lt;span class=&quot;oi oi-home&quot; aria-hidden=&quot;true&quot;&gt;&lt;/span&gt; Home
            &lt;/NavLink&gt;
        &lt;/li&gt;
        &lt;li class=&quot;nav-item px-3&quot;&gt;
            &lt;NavLink class=&quot;nav-link&quot; href=&quot;counter&quot;&gt;
                &lt;span class=&quot;oi oi-plus&quot; aria-hidden=&quot;true&quot;&gt;&lt;/span&gt; Counter
            &lt;/NavLink&gt;
        &lt;/li&gt;
        &lt;li class=&quot;nav-item px-3&quot;&gt;
            &lt;NavLink class=&quot;nav-link&quot; href=&quot;fetchdata&quot;&gt;
                &lt;span class=&quot;oi oi-list-rich&quot; aria-hidden=&quot;true&quot;&gt;&lt;/span&gt; Fetch data
            &lt;/NavLink&gt;
        &lt;/li&gt;
    &lt;/ul&gt;
&lt;/div&gt;

@code {
    [Inject] NavigationManager NavManager { get; set; }
    private bool _isWasm =&gt; NavManager?.Uri.Contains(&quot;wasm&quot;, StringComparison.CurrentCultureIgnoreCase) ?? false;
    private string _otherContextUrl =&gt; _isWasm ? &quot;/&quot; : &quot;/wasm&quot;;
    private string _otherContextLinkName =&gt; _isWasm ? &quot;Server Home&quot; : &quot;WASM Home&quot;;
    private string _title =&gt; _isWasm ? &quot;AllinOne WASM&quot; : &quot;AllinOne Server&quot;;
    private bool collapseNavMenu = true;
    private string NavMenuCssClass =&gt; collapseNavMenu ? &quot;collapse&quot; : null;

    private void ToggleNavMenu()
    {
        collapseNavMenu = !collapseNavMenu;
    }
}
</code></pre>
<h3 id="fetchdata.razor">FetchData.razor</h3>
<p>Update the Url for getting forecasts by adding a <code>/</code> at the start, the file is now in the root and not in <code>wasm</code>.</p>
<pre><code class="language-csharp">protected override async Task OnInitializedAsync()
{
    forecasts = await Http.GetFromJsonAsync&lt;WeatherForecast[]&gt;(&quot;/sample-data/weather.json&quot;);
}
</code></pre>
<h2 id="blazor.web">Blazor.Web</h2>
<p>Update the project file:</p>
<pre><code class="language-xml">&lt;Project Sdk=&quot;Microsoft.NET.Sdk.Web&quot;&gt;
  &lt;PropertyGroup&gt;
    &lt;TargetFramework&gt;net5.0&lt;/TargetFramework&gt;
  &lt;/PropertyGroup&gt;
  &lt;ItemGroup&gt;
    &lt;PackageReference Include=&quot;Microsoft.AspNetCore.Components.WebAssembly.Server&quot; Version=&quot;5.0.3&quot; /&gt;
  &lt;/ItemGroup&gt;
  &lt;ItemGroup&gt;
    &lt;ProjectReference Include=&quot;..\Blazor\Blazor.csproj&quot; /&gt;
  &lt;/ItemGroup&gt;
&lt;/Project&gt;
</code></pre>
<p>Add a Razor Page to <em>Pages</em> called <em>WASM.cshtml</em> - the launch page for the WASM SPA.</p>
<pre><code class="language-html">@page &quot;/wasm&quot;
@{
    Layout = null;
}

&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset=&quot;utf-8&quot; /&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no&quot; /&gt;
    &lt;title&gt;Blazor&lt;/title&gt;
    @*Change base*@
    &lt;base href=&quot;/wasm/&quot; /&gt;
    @*Update Link hrefs*@
    &lt;link href=&quot;/css/bootstrap/bootstrap.min.css&quot; rel=&quot;stylesheet&quot; /&gt;
    &lt;link href=&quot;/css/app.css&quot; rel=&quot;stylesheet&quot; /&gt;
    &lt;link href=&quot;/wasm/Blazor.styles.css&quot; rel=&quot;stylesheet&quot; /&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div id=&quot;app&quot;&gt;Loading...&lt;/div&gt;
    &lt;div id=&quot;blazor-error-ui&quot;&gt;
        An unhandled error has occurred.
        &lt;a href=&quot;&quot; class=&quot;reload&quot;&gt;Reload&lt;/a&gt;
        &lt;a class=&quot;dismiss&quot;&gt;ðŸ—™&lt;/a&gt;
    &lt;/div&gt;
    @*Update js sources *@
    &lt;script src=&quot;/wasm/_framework/blazor.webassembly.js&quot;&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>Add a second Razor Page to <em>Pages</em> called <em>Server.cshtml</em> - the launch page for the Servr SPA.</p>
<pre><code class="language-csharp">@page &quot;/&quot;
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@{
    Layout = null;
}

&lt;!DOCTYPE html&gt;
&lt;html&gt;

&lt;head&gt;
    &lt;meta charset=&quot;utf-8&quot; /&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no&quot; /&gt;
    &lt;title&gt;Blazor&lt;/title&gt;
    &lt;base href=&quot;/&quot; /&gt;
    &lt;link href=&quot;/css/bootstrap/bootstrap.min.css&quot; rel=&quot;stylesheet&quot; /&gt;
    &lt;link href=&quot;/css/site.css&quot; rel=&quot;stylesheet&quot; /&gt;
    &lt;link href=&quot;/wasm/Blazor.styles.css&quot; rel=&quot;stylesheet&quot; /&gt;
&lt;/head&gt;

&lt;body&gt;
    &lt;component type=&quot;typeof(Blazor.App)&quot; render-mode=&quot;ServerPrerendered&quot; /&gt;

    &lt;div id=&quot;blazor-error-ui&quot;&gt;
        &lt;environment include=&quot;Staging,Production&quot;&gt;
            An error has occurred. This application may no longer respond until reloaded.
        &lt;/environment&gt;
        &lt;environment include=&quot;Development&quot;&gt;
            An unhandled exception has occurred. See browser dev tools for details.
        &lt;/environment&gt;
        &lt;a href=&quot;&quot; class=&quot;reload&quot;&gt;Reload&lt;/a&gt;
        &lt;a class=&quot;dismiss&quot;&gt;ðŸ—™&lt;/a&gt;
    &lt;/div&gt;

    &lt;script src=&quot;_framework/blazor.server.js&quot;&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<h3 id="index.cshtml">Index.cshtml</h3>
<p>Update the <code>@page</code> directive to <code>@page &quot;/index&quot;</code>.</p>
<h3 id="startup.cs">Startup.cs</h3>
<p>Update <code>Startup</code> to handle WASM and Server middleware paths.</p>
<pre><code class="language-csharp">public class Startup
{
    public Startup(IConfiguration configuration)
    {
        Configuration = configuration;
    }

    public IConfiguration Configuration { get; }

    // This method gets called by the runtime. Use this method to add services to the container.
    public void ConfigureServices(IServiceCollection services)
    {
        services.AddRazorPages();
        services.AddServerSideBlazor();

        // Server Side Blazor doesn't register HttpClient by default
        // Thanks to Robin Sue - Suchiman https://github.com/Suchiman/BlazorDualMode
        if (!services.Any(x =&gt; x.ServiceType == typeof(HttpClient)))
        {
            // Setup HttpClient for server side in a client side compatible fashion
            services.AddScoped&lt;HttpClient&gt;(s =&gt;
            {
                // Creating the URI helper needs to wait until the JS Runtime is initialized, so defer it.
                var uriHelper = s.GetRequiredService&lt;NavigationManager&gt;();
                return new HttpClient
                {
                    BaseAddress = new Uri(uriHelper.BaseUri)
                };
            });
        }
    }

    // This method gets called by the runtime. Use this method to configure the HTTP request pipeline.
    public void Configure(IApplicationBuilder app, IWebHostEnvironment env)
    {
        if (env.IsDevelopment())
        {
            app.UseDeveloperExceptionPage();
        }
        else
        {
            app.UseExceptionHandler(&quot;/Error&quot;);
            // The default HSTS value is 30 days. You may want to change this for production scenarios, see https://aka.ms/aspnetcore-hsts.
            app.UseHsts();
        }

        app.UseHttpsRedirection();
        app.UseStaticFiles();

        app.MapWhen(ctx =&gt; ctx.Request.Path.StartsWithSegments(&quot;/wasm&quot;), app1 =&gt;
        {
            app1.UseBlazorFrameworkFiles(&quot;/wasm&quot;);
            app1.UseRouting();
            app1.UseEndpoints(endpoints =&gt;
            {
                endpoints.MapFallbackToPage(&quot;/wasm/{*path:nonfile}&quot;, &quot;/wasm&quot;);
            });
        });

        app.UseRouting();

        app.UseEndpoints(endpoints =&gt;
        {
            endpoints.MapControllers();
            endpoints.MapBlazorHub();
            endpoints.MapRazorPages();
            endpoints.MapFallbackToPage(&quot;/Server&quot;);
        });
    }
}
</code></pre>
<h2 id="run-the-application">Run the Application</h2>
<p>The application should now run.  It will start in the Server context.  Switch to the WASM context via the link in the left menu.  You should see the the colour change as you switch between contexts.</p>
<h2 id="adding-a-dataservice">Adding a DataService</h2>
<p>While the above configuation works, it needs some demo code to show how it handles more conventional data services.  We'll modify the solution to work with a very basic data services to show the DI and interface concepts that should be used.</p>
<p>Add <em>Data</em> and <em>Services</em> folders to the <em>Blazor</em> project.</p>
<h3 id="weatherforecast.cs">WeatherForecast.cs</h3>
<p>Add a <code>WeatherForecast</code> class to <em>Data</em>.</p>
<pre><code class="language-csharp">public class WeatherForecast
{
    public DateTime Date { get; set; }
    public int TemperatureC { get; set; }
    public string Summary { get; set; }
    public int TemperatureF =&gt; 32 + (int)(TemperatureC / 0.5556);
}
</code></pre>
<h3 id="iweatherforecastservice.cs">IWeatherForecastService.cs</h3>
<p>Add a <code>IWeatherForecastService</code> interface to <em>Services</em>.</p>
<pre><code class="language-csharp">    public interface IWeatherForecastService
    {
        public Task&lt;List&lt;WeatherForecast&gt;&gt; GetRecordsAsync();
    }
</code></pre>
<h3 id="weatherforecastserverservice.cs">WeatherForecastServerService.cs</h3>
<p>Add a <code>WeatherForecastServerService</code> class to <em>Services</em>.  Normally this would interface to a database, but here we're just creating a set of dummy records.</p>
<pre><code class="language-csharp">public class WeatherForecastServerService : IWeatherForecastService
{
    private static readonly string[] Summaries = new[]
    {
        &quot;Freezing&quot;, &quot;Bracing&quot;, &quot;Chilly&quot;, &quot;Cool&quot;, &quot;Mild&quot;, &quot;Warm&quot;, &quot;Balmy&quot;, &quot;Hot&quot;, &quot;Sweltering&quot;, &quot;Scorching&quot;
    };

    private List&lt;WeatherForecast&gt; records = new List&lt;WeatherForecast&gt;();

    public WeatherForecastServerService()
        =&gt; this.GetForecasts();

    public void GetForecasts()
    {
        var rng = new Random();
        records = Enumerable.Range(1, 10).Select(index =&gt; new WeatherForecast
        {
            Date = DateTime.Now.AddDays(index),
            TemperatureC = rng.Next(-20, 55),
            Summary = Summaries[rng.Next(Summaries.Length)]
        }).ToList();
    }

    public Task&lt;List&lt;WeatherForecast&gt;&gt; GetRecordsAsync()
        =&gt; Task.FromResult(this.records);
}
</code></pre>
<h3 id="weatherforecastapiservice.cs">WeatherForecastAPIService.cs</h3>
<p>Add a <code>WeatherForecastAPIService</code> class to <em>Services</em>.</p>
<pre><code class="language-csharp">public class WeatherForecastAPIService : IWeatherForecastService
{
    protected HttpClient HttpClient { get; set; }

    public WeatherForecastAPIService(HttpClient httpClient)
        =&gt; this.HttpClient = httpClient;

    public async Task&lt;List&lt;WeatherForecast&gt;&gt; GetRecordsAsync()
        =&gt; await this.HttpClient.GetFromJsonAsync&lt;List&lt;WeatherForecast&gt;&gt;($&quot;/api/weatherforecast/list&quot;);
}
</code></pre>
<h3 id="weatherforecastcontroller.cs">WeatherForecastController.cs</h3>
<p>Finally add a <code>WeatherForecastController</code> class to the <em>Blazor.Web</em> project in a <em>Controller</em> folder.</p>
<pre><code class="language-csharp">using System.Collections.Generic;
using System.Threading.Tasks;
using Blazor.Data;
using Microsoft.AspNetCore.Mvc;
using MVC = Microsoft.AspNetCore.Mvc;
using Blazor.Services;

namespace Blazor.Web.APIControllers
{
    [ApiController]
    public class WeatherForecastController : ControllerBase
    {
        protected IWeatherForecastService DataService { get; set; }

        public WeatherForecastController(IWeatherForecastService dataService)
            =&gt; this.DataService = dataService;

        [MVC.Route(&quot;/api/weatherforecast/list&quot;)]
        [HttpGet]
        public async Task&lt;List&lt;WeatherForecast&gt;&gt; GetList() =&gt; await DataService.GetRecordsAsync();
    }
}
</code></pre>
<h3 id="blazor-project-program.cs">Blazor Project Program.cs</h3>
<p>Add the API service to <em>Program.cs</em> in the <em>Blazor</em> project, declaring it through it's <code>IWeatherForecastService</code>.</p>
<pre><code class="language-csharp">public class Program
{
    public static async Task Main(string[] args)
    {
        var builder = WebAssemblyHostBuilder.CreateDefault(args);
        builder.RootComponents.Add&lt;App&gt;(&quot;#app&quot;);

        builder.Services.AddScoped(sp =&gt; new HttpClient { BaseAddress = new Uri(builder.HostEnvironment.BaseAddress) });
        builder.Services.AddScoped&lt;IWeatherForecastService, WeatherForecastAPIService&gt;();

        await builder.Build().RunAsync();
    }
}
</code></pre>
<h3 id="blazor.web-startup.cs">Blazor.Web Startup.cs</h3>
<p>Add the server service to <em>Startup.cs</em> in the <em>Blazor.Web</em> project, again through it's <code>IWeatherForecastService</code>.</p>
<pre><code class="language-csharp">public void ConfigureServices(IServiceCollection services)
{
    services.AddRazorPages();
    services.AddServerSideBlazor();
    services.AddScoped&lt;IWeatherForecastService, WeatherForecastServerService&gt;();
    .....
}
</code></pre>
<h2 id="building-and-run-the-project">Building and Run the project</h2>
<p>The solution should now build and run.</p>
<p><img src="https://shauncurtis.github.io/articles/assets/Blazor-AllinOne/Blazor-Project.png" alt="Blazor Project" /></p>
<p><img src="https://shauncurtis.github.io/articles/assets/Blazor-AllinOne/Blazor-Web-Project.png" alt="Blazor.Web Project" /></p>
<h2 id="how-does-it-work">How Does It Work?</h2>
<p>Fundimentally, the difference between a Blazor Server and a Blazor WASM Application is the context in which it's run.  In the solution all SPA code is built in the Web Assembly project, and used by both the WASM and Server contexts.  There's no &quot;shared&quot; code library code, because it's exactly the same front end code with the same entrypoint - App.razor.  The different between the two contexts, is the provider of the backend services.</p>
<p>The web assembly project is declared <code>&lt;Project Sdk=&quot;Microsoft.NET.Sdk.BlazorWebAssembly&quot;&gt;</code>.  It builds both a standard <em>Blazor.dll</em> file and the WASM specific code including the Web Assembly &quot;boot configuration file&quot; <em>blazor.boot.json</em>.</p>
<p>In the web assembly context, the initial page loads <em>blazor.webassembly.js</em>.  This loads <em>blazor.boot.json</em> which tells <em>blazor.webassembly.js</em> how to &quot;boot&quot; the Web assembly code in the browser.  It runs <code>Program</code> which builds the <code>WebAssemblyHost</code>, loads the defined services, and starts the <code>Renderer</code> which replaces the <em>app</em> html element with the root component specified in <code>Program</code>.  This loads the router, which reads the Url, gets the appropiate component, loads it into the specified layout, and begins the rendering process.  SPA up and running.</p>
<p>In the Server context, the server side code picks up the component reference in the initial load page and statically renders it.  It passes the rendered page to the client.  This loads and runs <code>blazor.server.js</code>, which calls back to the server SignalR Hub and gets the dynamically rendered app root component.  SPA up and running.  The services container and renderer are in the Blazor Hub - started by calling <code>services.AddServerSideBlazor()</code> in Startup when the web server starts.</p>
<p>The data services we implemented demonstrate Dependancy injection and interfaces.  The UI components - in our case <code>FetchData</code> consume the <code>IWeatherForcastService</code> service registered in Services.  In the WASM context, the services container starts <code>WeatherForecastAPIService</code>, while in the Server context, the services container starts <code>WeatherForecastServerService</code>.  Two different services, conforming to the same interface and consumed by the UI components using the interface.  The UI components don't care which service they consume, it just needs to implement <code>IWeatherForcastService</code>.</p>
<h2 id="wrap-up">Wrap Up</h2>
<p>Hopefully this article has provided an insight into how Blazor SPAs work and the real differences between a Server and WASM Blazor SPA.</p>
<p>If you are reading this well into the future, the most recent version of this article will be <a href="https://shauncurtis.github.io/articles/Blazor-AllinOne.html">here</a>.</p>
</div></div></div></body></html>





