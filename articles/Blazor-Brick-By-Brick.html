<!DOCTYPE html>
<html lang="en"><head><meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<base href="/">

	

	

	
	<link href="/resources/vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
	<link href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i" rel="stylesheet">

	
	<link href="/resources/css/sb-admin-2.css" rel="stylesheet" type="text/css">
	<link href="/resources/css/site.css" rel="stylesheet" type="text/css">

	
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
	<link rel="stylesheet" href="/resources/css/article.css" type="text/css">

	
	<link rel="icon" href="/images/favicon.png">

	<title>Building a Blazor App from Scratch</title>
        <meta property="author" content="Shaun Curtis" />
        <meta property="description" content="This article describes how to build a Blazor App from the standard AspNetCore Web template." />
    <meta property="og:site_name" content="Cold Elm Coders" />
        <meta property="og:site" content="https://shauncurtis.github.io/" />
        <meta property="og:title" content="Building a Blazor App from Scratch" />
        <meta property="og:description" content="This article describes how to build a Blazor App from the standard AspNetCore Web template." /></head>
<body><header class="navbar bg-dark p-2 text-large text-light"><section class="navbar-section  text-light"><a href="/" class="navbar-brand mr-2 text-large text-light p-2">Cold Elm Coders</a>
			<a href="/Posts" class="btn btn-link text-light">Posts</a>
			<a href="/Rants" class="btn btn-link text-light">Rants</a>
			<a href="/Articles" class="btn btn-link text-light">Articles</a>
			<a href="/Stories" class="btn btn-link text-light">Stories</a>
			<a href="/about.html" class="btn btn-link text-light">About</a></section></header>

	<div class="container-fluid"><div class="row"><div class="col-12 col-sm-3 col-lg-2 bg-light pt-2"><div class="article-info p-2"><div class="mb-2">Published: 04-Jan-2022</div>
                <div class="mb-2">Updated: 04-Jan-2022</div>
                <div class="mb-2">Author: Shaun Curtis</div></div>
    <h4 class="p-2">Table of Contents</h4>
<ul class="TOC" >
<li class="TOC-item TOC-item-0" >
<a class="TOC-link" href="#">Top</a>
<ul class="TOC TOC-0" >
<li class="TOC-item TOC-item-1" >
<ul class="TOC TOC-1" >
<li class="TOC-item TOC-item-2" >
<a class="TOC-link" href="#prerequesites">Prerequesites</a>
</li>
<li class="TOC-item TOC-item-2" >
<a class="TOC-link" href="#code-repository">Code Repository</a>
</li>
<li class="TOC-item TOC-item-2" >
<a class="TOC-link" href="#building-the-project">Building the Project</a>
</li>
<li class="TOC-item TOC-item-2" >
<a class="TOC-link" href="#adding-a-blazor-component-to-a-razor-page">Adding a Blazor Component to a Razor Page</a>
</li>
<li class="TOC-item TOC-item-2" >
<a class="TOC-link" href="#configuring-the-server-to-run-the-blazor-services">Configuring the Server to run the Blazor Services</a>
</li>
<li class="TOC-item TOC-item-2" >
<a class="TOC-link" href="#building-a-blazor-spa">Building a Blazor SPA</a>
</li>
<li class="TOC-item TOC-item-2" >
<a class="TOC-link" href="#building-a-full-blazor-server-app">Building a Full Blazor Server App</a>
</li>
<li class="TOC-item TOC-item-2" >
<a class="TOC-link" href="#setting-the-blazor-app-as-default">Setting the Blazor App as Default</a>
</li>
<li class="TOC-item TOC-item-2" >
<a class="TOC-link" href="#summary">Summary</a>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
			
			<div class="col-12 col-sm-9 col-lg-10 p-2"><div class="pt-2 pb-2 border-bottom mb-4 text-primary"><h1>Building a Blazor App from Scratch</h1>
            <div><small>This article describes how to build a Blazor App from the standard AspNetCore Web template.</small></div></div>
    <p>In this article we'll build a Blazor Server Application brick-by-brick from the standard AspNetCore Web Application template.</p>
<p>The purpose of this article is a practical lesson in what Blazor really is and how you can start using it.  It should help you understand Blazor more quickly than simply deploying the template and playing with it.</p>
<p>While I'm a firm advocate of Visual Studio, we use Visual Studio code for this exercise to get a bit closer to the coal face.</p>
<h2 id="prerequesites">Prerequesites</h2>
<ul>
<li>Visual Studio Code</li>
<li>Net6.0 SDK</li>
</ul>
<blockquote>
<p>To keep things simple all the code and components are in a single namespace <strong>Blazr</strong>.</p>
</blockquote>
<h2 id="code-repository">Code Repository</h2>
<p>You can find all the code in the <a href="https://github.com/ShaunCurtis/BlazrServer">BlazrServer</a> Github Repository.</p>
<h2 id="building-the-project">Building the Project</h2>
<ol>
<li><p>Create a <em>Repos</em> folder in <em>Documents</em> (if you don't already have one).</p>
</li>
<li><p>Create a <em>Repos/BlazorServer</em> folder.</p>
</li>
<li><p>Open Visual Studio Code on the folder.</p>
</li>
<li><p><code>Ctl + '</code> to open the terminal.</p>
</li>
</ol>
<p>We're ready to deploy a template to the current folder.  But which one?</p>
<pre><code>PS C:\Users\shaun\source\repos\BlazrServer &gt; dotnet new --list
</code></pre>
<p>Will list all the installed templates.</p>
<p>We're after:</p>
<pre><code>ASP.NET Core Web App                          webapp,razor         [C#]        Web/MVC/Razor Pages
</code></pre>
<p>To use this:</p>
<pre><code>PS &gt; dotnet new razor
</code></pre>
<p>And we get:</p>
<pre><code>The template &quot;ASP.NET Core Web App&quot; was created successfully.
This template contains technologies from parties other than Microsoft, see https://aka.ms/aspnetcore/6.0-third-party-notices for details.

Processing post-creation actions...
Running 'dotnet restore' on C:\Users\shaun\source\repos\BlazorServer\BlazorServer.csproj...
  Determining projects to restore...
  Restored C:\Users\shaun\source\repos\BlazorServer\BlazorServer.csproj (in 90 ms).
Restore succeeded.
</code></pre>
<p>A set of folders and files deployed into the directory.</p>
<p>At this point we can:</p>
<pre><code>PS &gt; dotnet watch run debug
</code></pre>
<p>to get this:</p>
<pre><code>PS C:\Users\shaun\source\repos\BlazorServer&gt; dotnet watch run debug
watch : Started
Building...
info: Microsoft.Hosting.Lifetime[14]
      Now listening on: https://localhost:7280
info: Microsoft.Hosting.Lifetime[14]
      Now listening on: http://localhost:5280
info: Microsoft.Hostingetime[0]
      Application started. Press Ctrl+C to shut down.
info: Microsoft.Hosting.Lifetime[0]
      Hosting environment: Development
info: Microsoft.Hosting.Lifetime[0]
      Content root path: C:\Users\shaun\source\repos\BlazorServer\
</code></pre>
<p>And our site.</p>
<p><img src="https://shauncurtis.github.io/articles/assets/Blazor-App/Base-Template-Run.png" alt="Base Template" /></p>
<p>Make a change to <em>Index.cshtml</em></p>
<pre><code>    &lt;h1 class=&quot;display-4&quot;&gt;Welcome To my Nascient Blazor App&lt;/h1&gt;
</code></pre>
<p>and save it.  We get:</p>
<pre><code>watch : Exited
watch : File changed: C:\Users\shaun\source\repos\BlazorServer\Pages\Index.cshtml
watch : Started
Building...
info: Microsoft.Hosting.Lifetime[14]
      Now listening on: https://localhost:7280
info: Microsoft.Hosting.Lifetime[14]
      Now listening on: http://localhost:5280
info: Microsoft.Hosting.Lifetime[0]
      Application started. Press Ctrl+C to shut down.
info: Microsoft.Hosting.Lifetime[0]
      Hosting environment: Development
info: Microsoft.Hosting.Lifetime[0]
      Content root path: C:\Users\shaun\source\repos\BlazorServer\
</code></pre>
<p><img src="./assets/Blazor-App/Base-modified-Template-Run.png" alt="Base Template" /></p>
<p>Hot reload is working. We have a running Razor web application.</p>
<p>To wrap up this section, let's take a quick look at <code>Program</code>.</p>
<pre><code class="language-csharp">// Initialise the WebApplication Builder
var builder = WebApplication.CreateBuilder(args);

// Add services to the container.
builder.Services.AddRazorPages();

// Build the App from the builder
var app = builder.Build();

// Configure the HTTP request pipeline.
if (!app.Environment.IsDevelopment())
{
    app.UseExceptionHandler(&quot;/Error&quot;);
    app.UseHsts();
}
app.UseHttpsRedirection();
app.UseStaticFiles();
app.UseRouting();
app.UseAuthorization();
app.MapRazorPages();

// Run the Application
app.Run();
</code></pre>
<p>This:</p>
<ol>
<li>Creates an instance of the <code>WebApplicationBuilder</code> class.</li>
<li>Adds a set of services to builder's ServiceCollection.  These define the services that can be used by the <code>WebApplication</code> instance's Dependency Injection container.</li>
<li>Builds the <code>WebApplication</code> instance.</li>
<li>Adds a set of Middleware to handle the web request pipeline serviced by the <code>WebApplication</code> instance.</li>
<li>Runs the configured <code>WebApplication</code> instance.</li>
</ol>
<h2 id="adding-a-blazor-component-to-a-razor-page">Adding a Blazor Component to a Razor Page</h2>
<p>Add a <em>Components</em> folder and a <em>/Component/HelloBlazor.razor</em> component file.</p>
<p>It just displays a message and the time.  We use the time so we can easily see if updates happen and when render events occur.</p>
<pre><code class="language-csharp">@inherits ComponentBase
@namespace Blazr

&lt;div&gt;
    &lt;h1&gt;Hello Blazor at @(time.ToLongTimeString())&lt;/h1&gt;
    &lt;div class=&quot;m-3&quot;&gt;
        Todays Message is : @Message
    &lt;/div&gt;
    &lt;div class=&quot;m-3&quot;&gt;
        &lt;button class=&quot;btn btn-primary&quot; @onclick=&quot;GetTime&quot;&gt;Set Time&lt;/button&gt;
    &lt;/div&gt;
&lt;/div&gt;

@code {
    [Parameter] public string Message {get; set;} = string.Empty;

    private DateTime time = DateTime.Now;

    protected override void OnInitialized() 
        =&gt;  time = DateTime.Now;

    private void GetTime() 
        =&gt; time = DateTime.Now;
}
</code></pre>
<p>Add a <em>Component.cshtml</em> to <em>Pages</em>.</p>
<pre><code>@page
@{
    ViewData[&quot;Title&quot;] = &quot;Component page&quot;;
}

&lt;div class=&quot;text-center&quot;&gt;
    &lt;h1 class=&quot;display-4&quot;&gt;Welcome To my Component Page&lt;/h1&gt;
    @(await Html.RenderComponentAsync&lt;Components.HelloBlazor&gt;(RenderMode.ServerPrerendered, new { Message = &quot;Hello there!&quot; }))

    &lt;script src=&quot;_framework/blazor.server.js&quot;&gt;&lt;/script&gt;
&lt;/div&gt;
</code></pre>
<p>In <em>_layout.cshtml</em> add a new top menu item:</p>
<pre><code class="language-html">    &lt;li class=&quot;nav-item&quot;&gt;
        &lt;a class=&quot;nav-link text-dark&quot; asp-area=&quot;&quot; asp-page=&quot;/Component&quot;&gt;Component&lt;/a&gt;
    &lt;/li&gt;
</code></pre>
<p>You should now be able to navigate to <em>Component</em> and see the page render.  Click on the button and,  nothing happens.</p>
<p>We have a component that is statically rendered by the server.  However, there's no Blazor services configured.  Open Developer tools and you will see a JS error.</p>
<p><img src="./assets/Blazor-App/blazor-server-js-error.png" alt="JS Error" /></p>
<p>The Server has pre-rendered the component and then passed the generated markup to the browser.  What is failing is the Blazor Server JS code.  There's no <em>_framework/blazor.server.js</em> to download.</p>
<h2 id="configuring-the-server-to-run-the-blazor-services">Configuring the Server to run the Blazor Services</h2>
<p>First we add the Blazor server-side services.  Update <code>Program</code>:</p>
<pre><code class="language-csharp">// Add services to the container.
builder.Services.AddRazorPages();
builder.Services.AddServerSideBlazor();
</code></pre>
<p>Now check the browser and you will see two errors.  <em>blazor.server.js</em> is now available to download, but it can't run because there's no Blazor Hub Middleware running on the server to service the SignalR requests.</p>
<p>Now add the BlazorHub middleware to <code>Program</code>:</p>
<pre><code>app.MapRazorPages();
app.MapBlazorHub();
</code></pre>
<p>Everything now runs with no errors.  But the button click doesn't work:  the time doesn't update!</p>
<p>Go to <em>HelloBlazor.razor</em> and note that VS Code is have trouble recognising <code>@onclick</code>.  We need <em>Microsoft.AspNetCore.Components.Web</em> to sort that.</p>
<p><img src="./assets/Blazor-App/Component-No-Library.png" alt="onclick Error" /></p>
<p>Update <em>HelloBlazor.razor</em> by adding a using to the top of the file.</p>
<pre><code class="language-csharp">@inherits ComponentBase
@namespace Components
@using Microsoft.AspNetCore.Components.Web  // New
</code></pre>
<p><img src="./assets/Blazor-App/Component-With-Library.png" alt="onclick Error" /></p>
<p>The button now works and updates the time.</p>
<p><img src="./assets/Blazor-App/Blazor-Component.png" alt="Base Template" /></p>
<p>We have a Blazor Component running our Razor Server side page.  A bit of Deja-Vu for old hands!</p>
<h2 id="building-a-blazor-spa">Building a Blazor SPA</h2>
<p>Components running in a Razor page isn't a Single Page Application.  Or is it?</p>
<p>Before we build the full version - as in the Blazor templates - we'll build a very simple SPA.</p>
<p>Add a <em>_Imports.razor</em> file to the project root and add the following code.  This sets up the global assemblies for all razor components.</p>
<pre><code class="language-csharp">@using System.Net.Http
@using Microsoft.AspNetCore.Authorization
@using Microsoft.AspNetCore.Components.Authorization
@using Microsoft.AspNetCore.Components.Forms
@using Microsoft.AspNetCore.Components.Routing
@using Microsoft.AspNetCore.Components.Web
@using Microsoft.AspNetCore.Components.Web.Virtualization
@using Microsoft.JSInterop
</code></pre>
<p>Add a <em>Routes</em> folder to the project and add the following razor components:</p>
<p><em>/Routes/Index.razor</em></p>
<pre><code class="language-csharp">@namespace Blazr

&lt;PageTitle&gt;Index&lt;/PageTitle&gt;

&lt;h1&gt;Hello, world!&lt;/h1&gt;

Welcome to your new app.
</code></pre>
<p><em>/Routes/Counter.razor</em></p>
<pre><code class="language-csharp">@namespace Blazr

&lt;PageTitle&gt;Counter&lt;/PageTitle&gt;

&lt;h1&gt;Counter&lt;/h1&gt;

&lt;p role=&quot;status&quot;&gt;Current count: @currentCount&lt;/p&gt;

&lt;button class=&quot;btn btn-primary&quot; @onclick=&quot;IncrementCount&quot;&gt;Click me&lt;/button&gt;

@code {
    private int currentCount = 0;

    private void IncrementCount()
     =&gt;  currentCount++;
}
</code></pre>
<p><em>/Routes/Hello.razor</em></p>
<pre><code class="language-csharp">@namespace Blazr

&lt;HelloBlazor&gt;&lt;/HelloBlazor&gt;
</code></pre>
<p>Add an <em>Apps</em> folder and add:</p>
<p><em>/Apps/BaseApp.razor</em></p>
<pre><code class="language-html">@using Microsoft.AspNetCore.Components;
@using Microsoft.AspNetCore.Components.Rendering;
@using Microsoft.AspNetCore.Components.Web;

@namespace Blazr

&lt;nav class=&quot;navbar navbar-expand-lg navbar-light bg-light&quot;&gt;
    &lt;div class=&quot;container-fluid&quot;&gt;
        &lt;h2 class=&quot;navbar-brand&quot;&gt;Blazor Simple App&lt;/h2&gt;
        &lt;div class=&quot;collapse navbar-collapse&quot; id=&quot;navbarSupportedContent&quot;&gt;
            &lt;ul class=&quot;navbar-nav me-auto mb-2 mb-lg-0&quot;&gt;
                &lt;li class=&quot;nav-item&quot;&gt;
                    &lt;a class=&quot; btn nav-link&quot; @onclick='() =&gt; this.ChangeRootComponent(&quot;Index&quot;)'&gt;Index&lt;/a&gt;
                &lt;/li&gt;
                &lt;li class=&quot;nav-item&quot;&gt;
                    &lt;a class=&quot;btn nav-link&quot; @onclick='() =&gt; this.ChangeRootComponent(&quot;Counter&quot;)'&gt;Counter&lt;/a&gt;
                &lt;/li&gt;
                &lt;li class=&quot;nav-item&quot;&gt;
                    &lt;a class=&quot;btn nav-link&quot; @onclick='() =&gt; this.ChangeRootComponent(&quot;Hello&quot;)'&gt;Hello&lt;/a&gt;
                &lt;/li&gt;
                &lt;li class=&quot;nav-item&quot;&gt;
                    &lt;a class=&quot;btn nav-link &quot; @onclick=&quot;this.GoServerIndex&quot;&gt;Server Home&lt;/a&gt;
                &lt;/li&gt;
            &lt;/ul&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/nav&gt;
&lt;div class=&quot;ms-5&quot;&gt;
    @body
&lt;/div&gt;
</code></pre>
<pre><code class="language-csharp">@code {
    [Inject] private NavigationManager? NavManager { get; set; }

    private Dictionary&lt;string, Type&gt; Routes =&gt; new Dictionary&lt;string, Type&gt; {
        {&quot;Index&quot;, typeof(Blazr.Index)},
        {&quot;Counter&quot;, typeof(Blazr.Counter)},
        {&quot;Hello&quot;, typeof(Blazr.Hello)}
    };

    private Type rootComponent = typeof(Blazr.Index);

    private RenderFragment body =&gt; (RenderTreeBuilder builder) =&gt;
    {
        builder.OpenComponent(0, rootComponent);
        builder.CloseComponent();
    };

    public void ChangeRootComponent(string route)
    {
        if (Routes.ContainsKey(route))
        {
            rootComponent = Routes[route];
            StateHasChanged();
        }
    }

    public void GoServerIndex()
    =&gt; this.NavManager?.NavigateTo(&quot;/Index&quot;, true);
}
</code></pre>
<p><code>rootComponent</code> is the <code>Type</code> of component to render: the default is <code>Index.razor</code>.  The Nav bar calls <code>ChangeRootComponent</code> which changes <code>rootComponent</code> and requests a component re-render by calling <code>StateHasChanged</code>.</p>
<p><code>body</code> is a <code>RenderFragment</code> that simply adds <code>rootComponent</code> to the render tree and renders it.  In practice we would check that <code>rootComponent</code> implements <code>IComponent</code>: all components must implement <code>IComponent</code>.  I haven't implemented the code to keep things simple and easy to read.</p>
<p><code>GoHome</code> uses the <code>NavigationManager</code> to trigger a full browser reload, and thus loads the default server page.</p>
<p>Add a link to <em>_Layout.cshtml</em></p>
<pre><code class="language-html">    &lt;li class=&quot;nav-item&quot;&gt;
        &lt;a class=&quot;nav-link text-dark&quot; asp-area=&quot;&quot; asp-page=&quot;/SimpleBlazor&quot;&gt;Blazor Simple App&lt;/a&gt;
    &lt;/li&gt;
</code></pre>
<p>Add <em>/Pages/SimpleBlazor.cshtml</em></p>
<pre><code>@page
@{
    Layout = null;
}
&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;utf-8&quot; /&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot; /&gt;
    &lt;title&gt;@ViewData[&quot;Title&quot;] - BlazorServer&lt;/title&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;~/lib/bootstrap/dist/css/bootstrap.min.css&quot; /&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;~/css/site.css&quot; asp-append-version=&quot;true&quot; /&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;~/BlazorServer.styles.css&quot; asp-append-version=&quot;true&quot; /&gt;
&lt;/head&gt;
&lt;body&gt;
        @(await Html.RenderComponentAsync&lt;Blazr.BaseApp&gt;(RenderMode.ServerPrerendered))

    &lt;script src=&quot;_framework/blazor.server.js&quot;&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>You should now be able to navigate to the Simple App, and navigate between the top menu bar links.</p>
<p><img src="./assets/Blazor-App/Simple-Blazor.png" alt="Base Template" /></p>
<h3 id="section-summary">Section Summary</h3>
<p>We've created a server side razor page, loading a Blazor component as it's main content.  This component consists of a navigation bar and a sub-component.  Clicking on the links in the navigation bar just change out the sub-component.  <code>StateHasChanged</code> queues a re-render of the page on the Renderer's queue.  The Renderer runs the render (in reality a <code>RenderFragment</code> that represents the page), works out any differences between the old DOM and the new DOM, and passes those to the browser to update the browser displayed DOM.  No page navigation involved, just DOM changes.</p>
<h2 id="building-a-full-blazor-server-app">Building a Full Blazor Server App</h2>
<h3 id="adding-files-from-the-repo">Adding files from the Repo</h3>
<p>We need to add some files from the Blazor application.</p>
<p>Add a <em>/Routes/Shared</em> folder and add the following files from the Repo:</p>
<ul>
<li><em>MainLayout.razor</em></li>
<li><em>MainLayout.razor.css</em></li>
<li><em>NavMenu.razor</em></li>
<li><em>NavMenu.razor.css</em></li>
</ul>
<p>These are the standard files from the Blazor Template with the namespace set and the NavLinks tweaked.</p>
<p>Add the following file to wwwroot/css</p>
<ul>
<li>blazor-site.css</li>
</ul>
<p>This is the standard Blazor site file renamed.</p>
<h3 id="app-component">App Component</h3>
<p>Add <em>/Apps/App.razor</em> and add the out-of-the-box code.</p>
<pre><code class="language-csharp">@namespace Blazr
&lt;Router AppAssembly=&quot;@typeof(App).Assembly&quot;&gt;
    &lt;Found Context=&quot;routeData&quot;&gt;
        &lt;RouteView RouteData=&quot;@routeData&quot; DefaultLayout=&quot;@typeof(MainLayout)&quot; /&gt;
        &lt;FocusOnNavigate RouteData=&quot;@routeData&quot; Selector=&quot;h1&quot; /&gt;
    &lt;/Found&gt;
    &lt;NotFound&gt;
        &lt;PageTitle&gt;Not found&lt;/PageTitle&gt;
        &lt;LayoutView Layout=&quot;@typeof(MainLayout)&quot;&gt;
            &lt;p role=&quot;alert&quot;&gt;Sorry, there's nothing at this address.&lt;/p&gt;
        &lt;/LayoutView&gt;
    &lt;/NotFound&gt;
&lt;/Router&gt;
</code></pre>
<h3 id="routing">Routing</h3>
<p>For routing to work, we need to add router page attributes to components we want the Router to treat as routes.</p>
<p>Update the following components, adding a page route.  A component can have more than one route.</p>
<p><em>Routes/Index.razor</em></p>
<pre><code class="language-html">@page &quot;/&quot;
@page &quot;/App&quot;
......
</code></pre>
<p><em>Routes/Counter.razor</em></p>
<pre><code class="language-html">@page &quot;/Counter&quot;
......
</code></pre>
<p><em>Routes/Hello.razor</em></p>
<pre><code class="language-html">@page &quot;/Hello&quot;
......
</code></pre>
<h3 id="razor-server-side-pages">Razor Server-Side Pages</h3>
<p>Add <em>/Pages/Shared/_AppLayout.cshtml</em>.</p>
<p>This is the Blazor Server launch page, with a tweeked stylesheet setup.</p>
<pre><code class="language-html">@using Microsoft.AspNetCore.Components.Web
@namespace Layouts
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers

&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;utf-8&quot; /&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot; /&gt;
    &lt;base href=&quot;~/&quot; /&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;~/lib/bootstrap/dist/css/bootstrap.min.css&quot; /&gt;
    &lt;link href=&quot;css/blazor-site.css&quot; rel=&quot;stylesheet&quot; /&gt;
    &lt;link href=&quot;BlazorServer.styles.css&quot; rel=&quot;stylesheet&quot; /&gt;
    &lt;component type=&quot;typeof(HeadOutlet)&quot; render-mode=&quot;ServerPrerendered&quot; /&gt;
&lt;/head&gt;
&lt;body&gt;
    @RenderBody()

    &lt;div id=&quot;blazor-error-ui&quot;&gt;
        &lt;environment include=&quot;Staging,Production&quot;&gt;
            An error has occurred. This application may no longer respond until reloaded.
        &lt;/environment&gt;
        &lt;environment include=&quot;Development&quot;&gt;
            An unhandled exception has occurred. See browser dev tools for details.
        &lt;/environment&gt;
        &lt;a href=&quot;&quot; class=&quot;reload&quot;&gt;Reload&lt;/a&gt;
        &lt;a class=&quot;dismiss&quot;&gt;ðŸ—™&lt;/a&gt;
    &lt;/div&gt;

    &lt;script src=&quot;_framework/blazor.server.js&quot;&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>Add <em>/Pages/App.cshtml</em>.</p>
<p>This is the Blazor App launch page.  We specify <code>Blazor.App</code> as the launch class i.e. <em>App.razor</em>.</p>
<pre><code class="language-html">@page 
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@{
    Layout = &quot;_AppLayout&quot;;
}

&lt;component type=&quot;typeof(Blazr.App)&quot; render-mode=&quot;ServerPrerendered&quot; /&gt;

</code></pre>
<h3 id="navigation-changes">Navigation Changes</h3>
<p>Update <em>/Routes/Shared/NavMenu.razor</em></p>
<p>Add a new NavLink.</p>
<pre><code class="language-html">    &lt;div class=&quot;nav-item px-3&quot;&gt;
        &lt;NavLink class=&quot;btn nav-link&quot; @onclick=&quot;GoServerIndex&quot;&gt;
            &lt;span class=&quot;oi oi-list-rich&quot; aria-hidden=&quot;true&quot;&gt;&lt;/span&gt; Server Home
        &lt;/NavLink&gt;
    &lt;/div&gt;
</code></pre>
<p>And add the <code>GoServerIndex</code> method to &quot;hard&quot; navigate to the server-side home page.</p>
<pre><code class="language-csharp">    public void GoServerIndex()
        =&gt; this.NavManager?.NavigateTo(&quot;/Index&quot;, true);
</code></pre>
<h3 id="web-changes">Web Changes</h3>
<p>Add a new link to the main page navigation in <em>/Pages/Shared/_Layout.cshtml</em>.</p>
<pre><code class="language-html">    &lt;li class=&quot;nav-item&quot;&gt;
        &lt;a class=&quot;nav-link text-dark&quot; asp-area=&quot;&quot; asp-page=&quot;/App&quot;&gt;Blazor App&lt;/a&gt;
    &lt;/li&gt;
</code></pre>
<p>Add a Fallback page endpoint to <code>Program</code>.  All fallbacks are directed to the Blazor Application.</p>
<pre><code class="language-csharp">//.....
app.MapBlazorHub();
app.MapFallbackToPage(&quot;/App&quot;);

app.Run();
</code></pre>
<p>You should now be able to navigate to the application and F5 to reload it.</p>
<h3 id="section-summary-1">Section Summary</h3>
<p>We now have a full blown Blazor Server application running with routing.  It's important to differentiate between Blazor Routing and Browser Navigation.  One way to physically detect the difference is to watch the &quot;Refresh&quot; button in the toolbar - the circle next to the forward button.  You can see it activate when you have a browser navigation event.</p>
<p>Routing occurs when you click the left Nav Menu in the Blazor application.  You may be clicking on an <code>anchor</code>, but the browser event is intercepted by the Blazor Javascript code, and received by the <code>Router</code> component.  It has a dictionary of Routes/Component - built by finding all the components with an <code>@page</code> attribute in the current assembly.  It looks up the component against the route, and loads the new component.  We created a very simple version of this in the Simple Blazor component.</p>
<h2 id="setting-the-blazor-app-as-default">Setting the Blazor App as Default</h2>
<p>The current setup has an <code>Index.cshtml</code> page with no <code>@page</code> set.  This is the default page for the site <em>https://localhost:nnnnn/</em>.</p>
<p>If there is a Blazor route component set as <code>@page &quot;/&quot;</code> why doesn't it use it?  This is where calling Blazor components with a route attribute &quot;Pages&quot; causes confusion.  Don't call them anything but a page: Routes, RouteComponents or RouteViews.  The web server knows nothing about the Blazor Routes.  The request runs through the configured middleware pipeline in Program. In our setup <code>app.MapRazorPages()</code> maps the Razor pages in <em>Pages</em> to the web route.  If it finds an index or default web file it uses it.</p>
<p>To understand what's happening look at the endpoint mapping in <code>Program</code></p>
<pre><code class="language-csharp">
app.MapRazorPages();
app.MapBlazorHub();
app.MapFallbackToPage(&quot;/App&quot;);

app.Run();
</code></pre>
<p>The current <code>Index.cshtml</code> is considered a default page and MapRazorPages() returns it.</p>
<p>To change our setup, set the page attribute on <em>Index.cshtml</em>.</p>
<pre><code class="language-html">@page &quot;/index&quot;
@model IndexModel
</code></pre>
<p><code>MapRazorPages</code> now maps <code>Index.cshtml</code> to <em>https://localhost:nnnnn/Index</em> and no longer treats it as a default page.</p>
<p>The request hits <code>app.MapFallbackToPage(&quot;/App&quot;)</code> which returns <code>App.cshtml</code> our Blazor App startup page.</p>
<h3 id="navigation-within-a-blazor-app">Navigation within a Blazor App</h3>
<p>So what happens if we have a link in the Blazor App that navigates to the web server <em>Index</em>?  We can see this <code>NavMenu</code>.</p>
<p>If we were to code <code>GoServerIndex</code> like this:</p>
<pre><code class="language-csharp">    public void GoServerIndex()
        =&gt; this.NavManager?.NavigateTo(&quot;/Index&quot;);
</code></pre>
<p>Blazor treats the request as local so routes, rather than navigates.  The router can't find a route match so displays it's &quot;Sorry, there's nothing at this address.&quot; message.</p>
<p>To &quot;hard&quot; navigate we need to do this:</p>
<pre><code class="language-csharp">    public void GoServerIndex()
        =&gt; this.NavManager?.NavigateTo(&quot;/Index&quot;, true);
</code></pre>
<p>This forces the <code>NavigationManager</code> to navigate, not route.</p>
<h2 id="summary">Summary</h2>
<p>There are a few tweeks I've made that make my implementation different from the out-of-the-box template.  These are:</p>
<ol>
<li>I've removed FetchData, it just complicates things.</li>
<li>The App <code>NavMenu</code> points Index to <em>/App</em> and not <em>/</em>.</li>
<li><em>Index.razor</em> has an added <code>@page &quot;/App&quot;</code>.</li>
<li>All the Blazor <em>Pages</em> components are now in <em>Routes</em>.</li>
</ol>
<p>2 and 3 fix the &quot;default page problem&quot; i.e. the default page is the server razor file, not the Blazor Application.</p>
</div></div></div></body></html>





